<!-- signin.html -->
<div class="signin-container">
    <h2>Connexion</h2>

    <!-- ‚úÖ Monitoring des tokens -->
    <div class="token-monitor">
        <h3>Token Monitor</h3>

        @if (authService.currentToken(); as current) {
            <!-- Token actuel -->
            <div [class.refreshed]="authService.tokenRefreshed()" class="token-box current">
                <div class="token-header">
                    <span class="label">Token Actuel</span>
                    @if (authService.tokenRefreshed()) {
                        <span class="badge refreshed">üîÑ REFRESHED!</span>
                    }
                    <span [class]="tokenStatus()" class="badge">
                        {{ tokenStatus() === 'ok' ? '‚úÖ' : tokenStatus() === 'warning' ? '‚ö†Ô∏è' : 'üî¥' }}
                        {{ timeLeftFormatted() }}
                    </span>
                </div>
                <div class="token-content">
                    <code>{{ current.token }}</code>
                </div>
                <div class="token-info">
                    <div>√âmis: {{ current.issuedAt | date:'HH:mm:ss' }}</div>
                    <div>Expire: {{ current.expiresAt | date:'HH:mm:ss' }}</div>
                </div>
            </div>

            <!-- Token pr√©c√©dent -->
            @if (authService.previousToken(); as previous) {
                <div class="token-box previous">
                    <div class="token-header">
                        <span class="label">Token Pr√©c√©dent</span>
                        <span class="badge expired">EXPIR√â</span>
                    </div>
                    <div class="token-content">
                        <code>{{ formatToken(previous.token) }}</code>
                    </div>
                    <div class="token-info">
                        <div>√âmis: {{ previous.issuedAt | date:'HH:mm:ss' }}</div>
                        <div>Expir√©: {{ previous.expiresAt | date:'HH:mm:ss' }}</div>
                    </div>
                </div>
            }
        } @else {
            <div class="token-box empty">
                <p>Aucun token actif - Connectez-vous</p>
            </div>
        }
    </div>

    <!-- Formulaire de connexion -->
    @if (!otpSent()) {
        <form (ngSubmit)="sendOtp()" [formGroup]="emailForm">
            <div class="form-group">
                <label for="email">Email</label>
                <input formControlName="email" id="email" type="email">
            </div>
            <button [disabled]="emailForm.invalid" type="submit">
                Recevoir le code
            </button>
        </form>
    } @else {
        <form (ngSubmit)="verifyOtp()" [formGroup]="otpForm">
            <p>Code envoy√© √† {{ emailForm.value.email }}</p>

            <div class="form-group">
                <label for="otp">Code de v√©rification</label>
                <input
                    formControlName="otp"
                    id="otp"
                    maxlength="6"
                    placeholder="123456"
                    type="text">
            </div>

            <button [disabled]="otpForm.invalid" type="submit">
                Se connecter
            </button>

            <button (click)="resetForm()" type="button">
                Modifier l'email
            </button>
        </form>
    }
</div>
